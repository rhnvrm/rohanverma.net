<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% if page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
    <meta name="author" content="{{ config.author }}">
    <meta name="theme-color" content="#14171c" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    
    <title>{% if page.title %}{{ page.title }} | {{ config.title }}{% elif section.title %}{{ section.title }} | {{ config.title }}{% else %}{{ config.title }}{% if config.extra.subtitle %} {{ config.extra.subtitle }}{% endif %}{% endif %}</title>
    
    <!-- Favicon -->
    {% if config.extra.favicon %}
    <link rel="icon" href="{{ config.extra.favicon }}" type="image/x-icon">
    {% endif %}
    
    <!-- RSS Feed -->
    {% if config.generate_feeds %}
    <link rel="alternate" type="application/rss+xml" title="{{ config.title }}" href="{{ get_url(path="index.xml") }}">
    {% endif %}
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ config.title }}{% endif %}">
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
    <meta property="og:url" content="{{ current_url }}">
    <meta property="og:site_name" content="{{ config.title }}">
    
    {% if page.date %}
    <meta property="article:published_time" content="{{ page.date | date(format='%Y-%m-%d') }}">
    <meta property="article:author" content="{{ config.author }}">
    {% endif %}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ config.title }}{% endif %}">
    <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% elif section.description %}{{ section.description }}{% else %}{{ config.description }}{% endif %}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Literata:ital,opsz,wght@0,7..72,400..700;1,7..72,400..700&family=JetBrains+Mono:ital,wght@0,400..600;1,400..600&display=swap" rel="stylesheet">
    
    <!-- Design System Styles -->
    <link rel="stylesheet" href="{{ get_url(path='main.css') }}">
    
    <!-- Theme Detection Script -->
    <script>
        // Detect theme preference and apply immediately to prevent flash
        (function() {
            const theme = localStorage.getItem('theme') || 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.classList.toggle('dark', theme === 'dark');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>

<body>


    <!-- Header -->
    <header class="header-main header-enhanced">
        <div class="container-full">
            <div class="container-wide">
                <div class="header-content">
                    <a href="/" class="nav-brand nav-brand-enhanced" aria-label="Home">
                        {{ config.title }}
                    </a>
                    
                    <!-- Mobile menu toggle -->
                    <button class="mobile-menu-toggle hidden-desktop" id="mobile-menu-toggle" aria-label="Toggle navigation menu">
                        ‚ò∞
                    </button>
                    
                    <!-- Navigation -->
                    <div class="header-nav header-nav-enhanced" id="nav-menu">
                        <nav class="nav-base nav-horizontal">
                            <a href="/" class="nav-item {% if current_path == '/' %}active{% endif %}">Home</a>
                            <a href="/blog/" class="nav-item {% if current_path is starting_with('/blog') %}active{% endif %}">Blog</a>
                            <a href="/projects/" class="nav-item {% if current_path is starting_with('/projects') %}active{% endif %}">Projects</a>
                            <a href="/now/" class="nav-item {% if current_path is starting_with('/now') %}active{% endif %}">Now</a>
                            <a href="/contact/" class="nav-item {% if current_path is starting_with('/contact') %}active{% endif %}">Contact</a>
                        </nav>
                        
                        <!-- Theme toggle -->
                        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                            <span class="theme-icon-light">‚òÄÔ∏è</span>
                            <span class="theme-icon-dark">üåô</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content">
        {% block content %}{% endblock content %}
    </main>

    <!-- Footer -->
    <footer class="footer-main">
        <div class="footer-content">
            <p>¬© {{ now() | date(format="%Y") }} Rohan Verma ‚Äî built with <a href="https://www.getzola.org">Zola</a> ¬∑ deployed via Nix</p>
            <p class="footer-links-row">
                <a href="https://github.com/rhnvrm">GitHub</a>
                <a href="/rss.xml">RSS</a>
                <a href="mailto:rohan@rohanverma.net">Email</a>
            </p>
            <p class="text-caption muted">All content is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license">CC BY-SA 4.0</a> unless otherwise noted.</p>
        </div>
    </footer>

    <!-- Reading Progress Bar (Bottom) -->
    {% if page %}
    <div class="progress-container-bottom">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    {% endif %}

    <!-- JavaScript -->
    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;

        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const isDark = html.classList.contains('dark');
                const newTheme = isDark ? 'light' : 'dark';
                html.classList.toggle('dark', !isDark);
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
        }

        // Mobile menu functionality
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const navMenu = document.getElementById('nav-menu');
        
        if (mobileMenuToggle && navMenu) {
            mobileMenuToggle.addEventListener('click', () => {
                navMenu.classList.toggle('active');
            });
        }

        // Reading progress bar (for articles)
        {% if page %}
        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            if (!progressBar) return;
            
            const totalHeight = document.body.scrollHeight - window.innerHeight;
            const progress = (window.pageYOffset / totalHeight) * 100;
            progressBar.style.width = Math.min(progress, 100) + '%';
        }
        
        window.addEventListener('scroll', updateProgressBar);
        window.addEventListener('resize', updateProgressBar);
        {% endif %}

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Page loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Content is ready
        });
    </script>
</body>
</html>